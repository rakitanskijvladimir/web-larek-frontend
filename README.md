# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении
```
// Интерфейс карточки полученной с сервера

export interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```
```
// Интерфейс выбранного товара по клику

export interface IChoiseProduct {
  onClick: (event: MouseEvent) => void;     
}
```
```
// интерфейс формы отправки

export interface IOrderList {
payment: string;
address: string;
phone: string;
email: string;
}
```
```
// Интерфейс завершенного результата

export interface IOrderResult {
  id: string;
  total: number;
}
```
```
// Проверка формы на ошибки
export type CheckErrors = Partial<Record<keyof IOrderList, string>>;
```


## Архитертура приложения

Код приложения разделен на слои которые отвечают парадигме MVP:\
-слой Model - отвечает за работу и хранение данных полученных с сервера и от пользователя\
-слой View - отвечает за отображение данных для работы с пользователем и работу с событиями\
-слой Presenter - отвечает за связь данных с отображением интерфейсов при срабатывании события.

## Базовые классы

### Класс Api
Базовый класс для отправки и получения запросов\
constructor(baseUrl: string) - принимает url сервера, по которому происходят запросы\
Поля класса:
- _baseUrl - базовый адрес полученный с сервера.\

Методы:
- handleResponse(response: Response) - принимает ответ от сервера и обрабатывает его или отклоняет промис с возникшей ошибкой
- get(url: string ) - возвращает ответ от сервера
- post(url: string ) - принимает данные в виде объекта для отправки на сервер

### Класс EventEmitter
Брокер событий, позволяющий отправлять события и подписываться на них. Класс используется для связи слоя Modal и View.\
constructor() - инициализирует брокер событий\
Поля класса:
- _events - события

Методы:
- on(eventName: EventName): void - подписывает на событие с заданным именем.
- off(eventName: EventName): - отписывается от события.
- emit(eventName: string): - инициирует событие с данными.

## Слой Model (Компоненты данных)

### Класс getData
Наследуется от класса Api, отвечает за отправление, получение и хранение данных с сервера.

Метод:
- getProduct - получет массив товара с сервера.
- postOrderList - получет ответ от сервера по выбранному товару.   
- setPreview - получает данные карточки которую кликнул пользователь.

### Класс basketModel 
Класс отвечает за хранение и работу с данными в корзине выбранных пользователем.
constructor(events: IEvents) -  отвечает за работу с товарами которые пользователь добавляет в корзину

Методы:
- addProductToBasket - добавляет товар в корзину.
- deleteProductToBasket - удаляет товар из корзины.
- getCounter - суммирует количество товаров в корзине.
- getCountSumProducts - считает и возвращает сумму синапсов всех товаров в корзине.

### Класс orderModel
Класс отвечает за хранение данных заполненных пользователем в формах.
constructor(container: HTMLFormElement, events: IEvents) -  принимает контейнер с формой для отправки на сервер

Методы:
- setPayment - устанавливает/принимает форму оплаты.
- setAddress - устанавливает/принимает адрес пользователя.
- setEmail - устанавливает/принимает электронную почту.
- setPhone - устанавливает/принимает номер телефона.
- validateAllOrder - проверяет корректность заполнения всех полей.
- getOrderProduct - возвращает данные пользователя с выбранными товарами.

## Слой View (Компоненты отображения)

### Класс Product
Отображает данные карточки товара полученные с сервера в целом и при выборе каждой карточки товара 
constructor(container: HTMLElement) - принимает DOM-элемент карточки.\
Поля класса:
- _cardElement: string - элемент карточки
- _cardCategory: string - элемент категории карточки
- _cardTitle: string - элемент заголовка карточки
- _cardImage: string - элемент картинки карточки
- _cardPrice: numder - элемент цены карточки
- _colors: string - элемент цены карточки
- _description: string - элемент описания карточки
- _button: string - элемент кнопки карточки

Методы:
- setText - принимает два значения, первое HTMLElement, второе значение задаёт текстовое содержимое HTMLElement.
- cardElement - принимает строчное значение и создаёт новый className для HTMLElement.
- productPrice - цену продукта в числовом значении и возвращает в строчном.
- notSale - принимает данные о продукте, проверяет наличие цены продукта, при отсутствии цены ограничивает покупку.

### Класс Basket
Отображает данные карточки товара в корзине.
constructor(events: IEvents) - принимает брокер событий.\
Поля класса:
- basket: string — элемент корзины
- title: string — элемент заголовка товара
- basketList: string - элемент перечня товара
- button: string — элемент кнопки\

При незаполненной корзине
- basketPrice: number — элемент цены товара 
- basketButton: string - элемент кнопки оформления заказа 
- basketCounter: string — элемент выбранного товара\ 

При заполненной корзине
- basketItem: string — элемент перечня товара
- index: string - элемент порядкового номера заказа
- price: number - элемент цены заказа
- buttonDelete: string - элемент кнопки удаления заказа

Методы:
- productListBasket - сохраняет и устанавливает общее количество товара в корзине.
- productSumBasket - сохраняет и устанавливает сумму синапсов всех товаров в корзине.
- productPrice - цену продукта в числовом значении и возвращает в строчном.

### Класс FillForms
Отображает и реализует форму оплаты и полей для заполнения контактов.
constructor(container: HTMLElement, events: IEvents) - принимает контейнер с формой и брокер событий.\
Поля класса:
- firstForm: string - кнопка для выбора оплаты при получении 
- buttonAll: string - кнопка для выбора оплаты картой
- paymentSelection: string - поле для заполнения адреса 
- checkErrors: string - поле для заполнения электронной почты       
- secondForm: string - поле для заполнения телефона 
- inputAll: string - поле для заполнения телефона 
- buttonSubmit: string - поле для заполнения телефона 

Методы:
- paymentSelection - устанавливаем обводку вокруг выбранного метода оплаты.

### Класс Modal
Отображает модальное окно. 
constructor(selector: string, events: IEvents) - принимает контейнер с формой и брокер событий.\
Поля класса:
- _modal: HTMLElement - элемент модального окна
- _events: IEvents - брокер событий

Методы:
- openModal.
- closeModal.

### Класс Success
Отображает успешное оформление заказа. 
constructor(container: HTMLElement, events: IEvents) - принимает контейнер с формой и брокер событий.\
Поля класса:
- _price: number - элемент суммы товара

## Слой коммуникаций
### Класс AppApi
Принимет в конструктор экземпляр класса Api и представляет методы реализующие
взаимодействие с бэкендом сервера.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле
`index.ts`, выполняющий роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью событий и 
обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

"Список всех событий, которые могут генерироваться в системе"\
`getCards:receive` - получение карточек с товаром\
`card:select` - изменения массива карточек\
`basket:open` - открытие модального окна с корзиной\
`basket:basketDelete` - удаление товара в корзине\
`order:open` - открытие модального окна для заполнения адреса и способа оплаты\
`order:paymentCheck` - проверка на валидность кнопки выбора оплаты\
`order:changeAddress` - изменение данных адреса в форме отправки заказа\
`checkErrors:address` - валидация поля адреса\
`contacts:open` - открытие модального окна для заполнения почты и телефона\
`contacts:open` - открытие модального окна для заполнения почты и телефона\
`contacts:changeInput` - отслеживание изменений\
`checkErrors:change` - валидация полей почты и телефона\
`success:close` - закрытие модального окна при успешном завершении\
`modal:open` - блокировка прокрутки\
`modal:close` - разблокировка прокрутки\    