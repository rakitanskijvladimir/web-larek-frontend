# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

# Данные и типы данных используемые в приложении

Получение ответа от сервера с карточками

```

interface IGetProductResponse { 
	total: number;              
  items: IProduct[];          
}
```

Карточки

```

interface IProduct {  
	id: string;           
	description: string;  
	image: string;        
	title: string;        
	category: string;     
	price: number;        
}
```

Корзина (модальное окно)

```

interface IProductBasket { 
    id: string;     
    title: string;  
    price: number;  
}
```

Формы отправки (модальное окно)

```

interface IOrderBody { 
    payment?: boolean,      
    email?: string,        
    phone?: string,        
    address?: string,       
    total?: number,         
    items: string[];       
}
```

Интерфейс для модели данных карточек

```

interface IProductData { 
    cards: IProduct[];  
    preview: string | null  
}
```

Данные карточек полученные с сервера 
```
type TGetProductData = Pick<IGetProductResponse, 'total' | 'items'> 
```

Массив данных принадлежащих каждой карточки
```
type TProductItems = Pick<IProduct, 'id' | 'description' | 'image' | 'title' | 'category' | 'price'> 
```

Данные карточек выбранные пользователем для отображения в корзине 
```
type TProductBasketList = Pick<IProductBasket, 'id' | 'title' | 'price'>
```

Данные пользователя для заполнения форм
```
type TOrderBodyForm = Pick<IOrderBody, 'payment' | 'email' | 'phone' | 'address' | 'total' | 'items'> 
```

## Архитертура приложения

Код приложения разделен на слои которые отвечают парадигме MVP:\
-слой представления отвечает на отображение данных на странице\
-слой даннных, отвечает на хранение и изменение данных\
-слой презентер отвечает за связь представления и данные\

### Базовый код

### Слой данных 
#### Класс IProductData 
Класс отвечает за хранение и логику работы с данными карточек полученных с сервера на основной странице сайта.\
Конструктор класса принимает брокер событий\
В полях класса хранятся следующие данные:
- _cards: IProduct[] - массив объектов карточек
- _preview: string | null - id объектов карточек выбранных для просмотра определенной карточки с товаром

Также классы представляют набор методов для взаимодействия с этими данными.
- addCard(card: IProduct): void - добавляет выбранную карточку в список покупок для дальнейшей оплаты (покупки)
- deleteCard(cardId: string, payment: Function | null): void - удаляет карточку из списка товаров (покупок)
- а также сеттеры и геттеры для созранения и получения данных из полей классов

#### Класс IProductBasketData 
Класс отвечает за хранение и логику работы с данными выбранного пользователем товара.\
- getProductList(): TProductBasketList - содержит данные выбранные покупателем для покупки 

#### Класс IOrderBodyData
Класс отвечает за проверку заполненных данных пользователем и отправку их на сервер.\
- onSubmit(cardId:string): void - отправляет данные
- checkValidation(data: Record<keyof TGetProductData, string>): boolean - проверяет данные пользователя на валидность 


### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых 
в них данных

#### Класс Modal
Реализует класс Modal. Также представляет методы 'open' и 'close' для управления 
отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, 
на клик в оверлей и кнопку-крестик для закрытия попапа.
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, 
по которому в разметке страницы будет идентифицировано модальное окно и экземпляр
класса `EventEmitter` для возможности инициализации события.

Поля класса 
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

#### Класс ModalWithConfirm
Расширяет класс Modal. Предназначен для реализации модального окна подтверждения.
При открытии модального окна сохраняет полученный в параметрах обработчик, который 
передаётся при для выполнения при сабмите формы.\
Поля класса:
- submitButton: HTMLButtonElement - Кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- handleSubmit: Function - функция, на выполнение которой запрашивается подтверждение

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- open(handleSubmit: Function): void - расширение родительского метода, принимает
обработчик, который передается при инициации события подтверждения.
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalWithConform
Расширяет класс Modal. Предназначен для реализации модального окна с формой содержащей
поля ввода. При сабмите инициирует событие передавая в него объект с данными из полей
ввода формы. При изменении данных в полях ввода инициирует событие изменения данных.
Представляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:
- submitButton: HTMLButtonElement - Кнопка подтверждения
- _form: HTMLFormElement - элемент формы
- formName: string - значение атрибута name формы
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок
под полями формы с привязкой к атрибуту name инпутов

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputvalues(): Record<string, string> - возвращает объект с данными из полей формы,
где ключ - name инпута, значение - данные введенные пользователем
- setInputValues(data: Record<string, string>): void - принимает объект с данными для 
заполнения полей формы
- setError(data: { field: string, value: string, validInfomation: string }): void - 
принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст
ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным полем ввода
- close (): void - расширяет родительский метод дополнительно при закрытии очищая поля
формы и деактивируя кнопку сохранения
- get form: HTMLElement - геттер для получения элемента формы

#### Класс Product
Отвечает за отображение карточки, задавая в карточке данные id, названия, изображение, описание, категорию, цену. 
Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM
элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки.
В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с 
которыми пользователь генерирует соответствующие события.\
Поля класса:
- _id: string - содержит индивидуальный номер каждой карточки
- _description: string - содержит описание товара
- _image: string - содержит картинку товара
- _title: string - содержит название(заголовок) карточки
- _category: string - содержит категорию товара
- _price: number - содержит цену товара

Методы:
- setData(cardData: IProduct, id: string): void - заполняет атрибуты элементов карточки данными
- setDescription(cardData: IProduct, description: string): void - заполняет данные описание товара
- setImage(cardData: IProduct, image: string): void - заполняет данные картинку товара
- setTitle(cardData: IProduct, title: string): void - заполняет данные название(заголовок) карточки
- setCategory(cardData: IProduct, category: string): void - заполняет данные категорию товара
- setPrice(cardData: IProduct, price: number): void - заполняет данные цену товара

#### Класс ProductBasket
Отвечает за отображение корзины в модальном окне. Также есть возможность удалить товар
из корзины. В конструктор класса передается DOM. Сохраняет необходимые элементы в разметке поля.
Поля: 
- _id: string - содержит индивидуальный номер каждой карточки
- _title: string - содержит название(заголовок) карточки
- _price: number - содержит цену товара

Методы:
- setData(cardData: IProduct, id: string): void - заполняет атрибуты элементов карточки данными
- setTitle(cardData: IProduct, title: string): void - заполняет данные название(заголовок) карточки
- setPrice(cardData: IProduct, price: number): void - заполняет данные цену товара

#### Класс Order
Отвечает за заполнение формы отправки заказа.  В конструктор класса передается DOM. Сохраняет и отправляет необходимые элементы в разметке поля.
Поля:
- _payment?: boolean - кнопка способа оплаты     
- _email?: string - поле для заполнения электронной почты       
- _phone?: string - поле для заполнения телефона        
- _address?: string - поле для заполнения адреса       
- _total?: number - поле для заполнения количества выбранного товара          
- _items: string[] - поле для заполнения карточки

Методы:
- setPayment(payment?: boolean) - устанавливает класс активности на кнопку
- setEmail(email?: string) - устанавливает значение поля электронной почты
- setPhone(phone?: string) - устанавливает значение поля телефона
- setAddress(address?: string) - устанавливает значение поля адрес
- setTotal(total?: number) - устанавливает значение для поля количество товара
- setItems(_items: string[]) - устанавливает значение для карточки товара

#### Класс Success
Отвечает за отображение успешного оформления заказа в модальном окне. 
- constructor(onClick: (): void) - принимает данные полученные от пользователя
Поля класса:
- _price: number - содержит цену товара
Методы:
- setPrice(cardData: IProduct, price: number): void - заполняет данные цену товара


### Слой коммуникаций
#### Класс AppApi
Принимет в конструктор экземпляр класса Api и представляет методы реализующие
взаимодействие с бэкендом сервера.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле
`index.ts`, выполняющий роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью событий и 
обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

"Список всех событий, которые могут генерироваться в системе"\
`cards:changed` - изменения массива карточек\
`order:open` - открытие модального окна с формой редактирования данных способа оплаты и адреса\
`contacts:open` - открытие модального окна с формой редактирования данных способа эл почты и телефона\
`card:button` - выбор способа оплаты\
`cash:button` - выбор способа оплаты\
`address:input` - изменение данных адреса в форме отправки заказа\
`email:input` - изменение данных электронной почты в форме отправки заказа\
`phone:input` - изменение данных телефона в форме отправки заказа\
`modalForm:address` - изменения массива карточек\
